{% extends 'a_inicio/base.html' %}
{% load static %}

{% block title %}Gestión de Roles{% endblock %}

{% block content %}

<div class="container-fluid py-4">
<div class="row">
<div class="col-12">
<h1 class="mb-4">Gestión de Roles</h1>
</div>
</div>

<!-- Botón para registrar un nuevo rol -->
<div class="row mb-3">
    <div class="col-12">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registrarRolModal">
            <i class="fas fa-plus-circle me-2"></i>Registrar Rol
        </button>
    </div>
</div>

<!-- Tabs de Roles -->
<ul class="nav nav-tabs" id="rolesTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="disponibles-tab" data-bs-toggle="tab" data-bs-target="#rolesDisponiblesTab" type="button" role="tab" aria-controls="rolesDisponiblesTab" aria-selected="true">Roles Disponibles</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="eliminados-tab" data-bs-toggle="tab" data-bs-target="#rolesEliminadosTab" type="button" role="tab" aria-controls="rolesEliminadosTab" aria-selected="false">Roles Eliminados</button>
    </li>
</ul>

<!-- Contenido de las Tabs -->
<div class="tab-content" id="rolesTabsContent">
    <div class="tab-pane fade show active" id="rolesDisponiblesTab" role="tabpanel" aria-labelledby="disponibles-tab">
        <!-- Tabla de Roles Disponibles -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="dataTableRolesDisponibles" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th class="text-center">ID</th>
                                        <th class="text-center">Nombre</th>
                                        <th class="text-center">Descripción</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <!-- Añadido el <tbody> explícito -->
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="rolesEliminadosTab" role="tabpanel" aria-labelledby="eliminados-tab">
        <!-- Tabla de Roles Eliminados -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="dataTableRolesEliminados" class="table table-striped table-bordered" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th class="text-center">ID</th>
                                        <th class="text-center">Nombre</th>
                                        <th class="text-center">Descripción</th>
                                        <th class="text-center">Fecha de Borrado</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <!-- Añadido el <tbody> explícito -->
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div>

<!-- Modal Registrar Rol -->

<div class="modal fade" id="registrarRolModal" tabindex="-1" aria-labelledby="registrarRolModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<form id="registrarRolForm" method="post" action="{% url 'a_central:registrar_rol' %}">
{% csrf_token %}
<div class="modal-header">
<h5 class="modal-title" id="registrarRolModalLabel">Registrar Nuevo Rol</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
<div class="mb-3">
<label for="nombre_rol" class="form-label">Nombre del Rol:</label>
<input type="text" class="form-control" id="nombre_rol" name="nombre_rol" required>
</div>
<div class="mb-3">
<label for="descripcion_rol" class="form-label">Descripción:</label>
<textarea class="form-control" id="descripcion_rol" name="descripcion_rol" rows="3"></textarea>
</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
<button type="submit" class="btn btn-primary">Guardar Rol</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Modificar Rol -->

<div class="modal fade" id="modificarRolModal" tabindex="-1" aria-labelledby="modificarRolModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<form id="modificarRolForm" method="post">
{% csrf_token %}
<input type="hidden" name="id_rol" id="modificar_id_rol">
<div class="modal-header">
<h5 class="modal-title" id="modificarRolModalLabel">Modificar Rol</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
<div class="mb-3">
<label for="modificar_nombre_rol" class="form-label">Nombre del Rol:</label>
<input type="text" class="form-control" id="modificar_nombre_rol" name="nombre_rol" required>
</div>
<div class="mb-3">
<label for="modificar_descripcion_rol" class="form-label">Descripción:</label>
<textarea class="form-control" id="modificar_descripcion_rol" name="descripcion_rol" rows="3"></textarea>
</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
<button type="submit" class="btn btn-primary">Guardar Cambios</button>
</div>
</form>
</div>
</div>
</div>

<!-- Modal Eliminar Rol -->

<div class="modal fade" id="eliminarRolModal" tabindex="-1" aria-labelledby="eliminarRolModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="eliminarRolModalLabel">Confirmar Eliminación</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
¿Estás seguro de que deseas eliminar este rol? Esta acción no es permanente.
<input type="hidden" id="eliminar_id_rol">
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
<button type="button" class="btn btn-danger" id="confirmarEliminarBtn">Confirmar</button>
</div>
</div>
</div>
</div>

<!-- Modal Restaurar Rol -->

<div class="modal fade" id="restaurarRolModal" tabindex="-1" aria-labelledby="restaurarRolModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="restaurarRolModalLabel">Confirmar Restauración</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
¿Estás seguro de que deseas restaurar este rol?
<input type="hidden" id="restaurar_id_rol">
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
<button type="button" class="btn btn-success" id="confirmarRestaurarBtn">Restaurar</button>
</div>
</div>
</div>
</div>

{% endblock %}

{% block scripts %}

<!-- Pasa las URLs de Django a JavaScript de forma segura -->
<script>
    window.AppUrls = {
        modificarRol: "{% url 'a_central:modificar_rol' rol_id=0 %}".replace('/0/', '/'),
        borrarRol: "{% url 'a_central:borrar_rol' rol_id=0 %}".replace('/0/', '/'),
        recuperarRol: "{% url 'a_central:recuperar_rol' rol_id=0 %}".replace('/0/', '/'),
    };
</script>

<!-- Archivo JS personalizado para los roles -->
<script src="{% static 'a_central/js/roles.js' %}"></script>

{% endblock %}
