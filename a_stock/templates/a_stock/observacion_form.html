{% extends "a_inicio/base.html" %}
{% block content %}

<div class="container mt-4">
    <h2 class="mb-4 text-center">Registrar Observaci√≥n de Stock</h2>

    <form method="POST">
        {% csrf_token %}

        <!-- üîπ Selecci√≥n de producto -->
        <div class="mb-3">
            <label class="form-label fw-bold">Producto</label>
            <select name="producto" id="producto" class="form-select" onchange="cargarLotes()">
                <option value="">Seleccione un producto...</option>

                {% for p in productos %}
                    <option value="{{ p.id_producto }}"
                        {% if producto_sel and producto_sel.id_producto == p.id_producto %}selected{% endif %}>
                        {{ p.nombre_producto }}
                    </option>
                {% endfor %}
            </select>
        </div>

        {% if producto_sel %}
        <!-- üîπ Selecci√≥n de lote (solo activos) -->
        <div class="mb-3">
            <label class="form-label fw-bold">Lote Activo</label>
            <select name="lote" class="form-select" required>
                <option value="">Seleccione un lote...</option>

                {% for lote in lotes %}
                    <option value="{{ lote.id_lote }}">
                        {{ lote.numero_lote }} ‚Äî Stock: {{ lote.cantidad }} ‚Äî Vence: {{ lote.fecha_vencimiento }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- üîπ Motivo -->
        <div class="mb-3">
            <label class="form-label fw-bold">Motivo</label>
            <select class="form-select" name="motivo" required>
                <option value="P√©rdida">P√©rdida</option>
                <option value="Rotura">Rotura</option>
                <option value="Vencimiento">Vencimiento</option>
            </select>
        </div>

        <!-- üîπ Cantidad -->
        <div class="mb-3">
            <label class="form-label fw-bold">Cantidad</label>
            <input type="number" name="cantidad" class="form-control" required min="1">
        </div>

        <!-- üîπ Fecha -->
        <div class="mb-3">
            <label class="form-label fw-bold">Fecha</label>
            <input type="date" name="fecha" class="form-control" required>
        </div>

        <!-- üîπ Descripci√≥n -->
        <div class="mb-3">
            <label class="form-label fw-bold">Descripci√≥n</label>
            <textarea name="descripcion" class="form-control" rows="3"></textarea>
        </div>

        <!-- üîπ Bot√≥n -->
        <button class="btn btn-success w-100">
            Guardar Observaci√≥n
        </button>

        {% endif %}
    </form>
</div>

<script>
function cargarLotes() {
    const id = document.getElementById("producto").value;
    if (id) {
        window.location.href = "?producto=" + id;
    } else {
        window.location.href = window.location.pathname;
    }
}
</script>

{% endblock %}
